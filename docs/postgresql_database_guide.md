# üìò –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å PostgreSQL –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

> **–î–ª—è –∫–æ–≥–æ**: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å –ë–î –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ  
> **–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å, –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –≥–æ—Ç–æ–≤—ã –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö](#1-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ-–∫-–±–∞–∑–µ-–¥–∞–Ω–Ω—ã—Ö)
2. [–ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î](#2-–ø—Ä–æ—Å–º–æ—Ç—Ä-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã-–±–¥)
3. [–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö](#3-–ø—Ä–æ—Å–º–æ—Ç—Ä-–¥–∞–Ω–Ω—ã—Ö)
4. [–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π (INSERT)](#4-–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-–∑–∞–ø–∏—Å–µ–π-insert)
5. [–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π (UPDATE)](#5-–∏–∑–º–µ–Ω–µ–Ω–∏–µ-–∑–∞–ø–∏—Å–µ–π-update)
6. [–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π (DELETE)](#6-—É–¥–∞–ª–µ–Ω–∏–µ-–∑–∞–ø–∏—Å–µ–π-delete)
7. [–ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã](#7-–ø–æ–ª–µ–∑–Ω—ã–µ-–∑–∞–ø—Ä–æ—Å—ã)
8. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –±—ç–∫–∞–ø—ã](#8-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å-–∏-–±—ç–∫–∞–ø—ã)

---

## 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### 1.1 –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH

–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –≤–∞—à–µ–º—É VPS —Å–µ—Ä–≤–µ—Ä—É:

```bash
ssh root@your-server-ip
```

–ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞:

```bash
cd /opt/llm-bot/app
```

### 1.2 –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL —á–µ—Ä–µ–∑ Docker

PostgreSQL —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ. –ï—Å—Ç—å –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

#### –°–ø–æ—Å–æ–± –ê: –ß–µ—Ä–µ–∑ Docker exec (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
docker exec -it llm-rag-bot-postgres-1 psql -U postgres -d catalog_db
```

**–ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- `docker exec` - –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- `-it` - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º
- `llm-rag-bot-postgres-1` - –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ PostgreSQL
- `psql` - –∫–ª–∏–µ–Ω—Ç PostgreSQL
- `-U postgres` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `-d catalog_db` - –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

#### –°–ø–æ—Å–æ–± –ë: –£–∑–Ω–∞—Ç—å –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –µ—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –≤—ã—à–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

–°–Ω–∞—á–∞–ª–∞ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

```bash
docker ps
```

–ù–∞–π–¥–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å postgres –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `llm-rag-bot-postgres-1`), –∑–∞—Ç–µ–º:

```bash
docker exec -it CONTAINER_NAME psql -U postgres -d catalog_db
```

### 1.3 –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

–ï—Å–ª–∏ –≤—Å—ë –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ, –≤—ã —É–≤–∏–¥–∏—Ç–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ:

```
catalog_db=#
```

**–ì–æ—Ç–æ–≤–æ! –í—ã –≤ PostgreSQL –∫–æ–Ω—Å–æ–ª–∏.**

### 1.4 –í—ã—Ö–æ–¥ –∏–∑ PostgreSQL

–ß—Ç–æ–±—ã –≤—ã–π—Ç–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ PostgreSQL:

```sql
\q
```

–ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ `Ctrl + D`

---

## 2. –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î

### 2.1 –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü

```sql
\dt
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
 Schema |       Name              | Type  |  Owner   
--------+-------------------------+-------+----------
 public | admin_users             | table | postgres
 public | alembic_version         | table | postgres
 public | catalog_versions        | table | postgres
 public | company_info            | table | postgres
 public | company_services        | table | postgres
 public | conversations           | table | postgres
 public | lead_interactions       | table | postgres
 public | leads                   | table | postgres
 public | llm_settings            | table | postgres
 public | messages                | table | postgres
 public | prompts                 | table | postgres
 public | system_logs             | table | postgres
 public | usage_statistics        | table | postgres
 public | users                   | table | postgres
```

### 2.2 –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞–±–ª–∏—Ü–µ

–ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã (–∫–æ–ª–æ–Ω–∫–∏, —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è):

```sql
\d users
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∫–∞–∂–µ—Ç:**
- –ù–∞–∑–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫
- –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (NOT NULL, PRIMARY KEY –∏ —Ç.–¥.)
- –ò–Ω–¥–µ–∫—Å—ã

### 2.3 –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ)

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–±–æ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö:

```sql
\d+
```

### 2.4 –°–ø–∏—Å–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± —á–µ—Ä–µ–∑ SQL –∑–∞–ø—Ä–æ—Å:

```sql
SELECT column_name, data_type, is_nullable, column_default
FROM information_schema.columns
WHERE table_name = 'users'
ORDER BY ordinal_position;
```

---

## 3. –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö

### 3.1 –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –±–æ–ª—å—à–∞—è, —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è!

```sql
SELECT * FROM users;
```

### 3.2 –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–≤—ã—Ö N –∑–∞–ø–∏—Å–µ–π

–ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π:

```sql
-- –ü–µ—Ä–≤—ã–µ 10 –∑–∞–ø–∏—Å–µ–π
SELECT * FROM users LIMIT 10;
```

### 3.3 –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫

–í—ã–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è:

```sql
SELECT id, chat_id, username, created_at FROM users LIMIT 10;
```

### 3.4 –ü–æ–∏—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏

–ü–æ ID:

```sql
SELECT * FROM users WHERE id = 1;
```

–ü–æ chat_id:

```sql
SELECT * FROM users WHERE chat_id = 123456789;
```

–ü–æ —á–∞—Å—Ç–∏—á–Ω–æ–º—É —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –∏–º–µ–Ω–∏):

```sql
SELECT * FROM users WHERE first_name LIKE '%–ò–≤–∞–Ω%';
```

### 3.5 –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞):

```sql
SELECT * FROM users ORDER BY created_at DESC LIMIT 10;
```

–ü–æ –∏–º–µ–Ω–∏ (–∞–ª—Ñ–∞–≤–∏—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫):

```sql
SELECT * FROM users ORDER BY username ASC LIMIT 10;
```

### 3.6 –ü–æ–¥—Å—á—ë—Ç –∑–∞–ø–∏—Å–µ–π

–°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ:

```sql
SELECT COUNT(*) FROM users;
```

–°–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º email:

```sql
SELECT COUNT(*) FROM users WHERE email IS NOT NULL;
```

### 3.7 –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü

–ü—Ä–∏–º–µ—Ä: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∏—Ö –ª–∏–¥—ã

```sql
SELECT 
    u.id, 
    u.username, 
    u.first_name,
    l.name AS lead_name,
    l.phone,
    l.status,
    l.created_at
FROM users u
LEFT JOIN leads l ON u.id = l.user_id
ORDER BY l.created_at DESC
LIMIT 20;
```

---

## 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π (INSERT)

### 4.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏

**–ë–∞–∑–æ–≤—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:**

```sql
INSERT INTO table_name (column1, column2, column3)
VALUES (value1, value2, value3);
```

### 4.2 –ü—Ä–∏–º–µ—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

#### –ü—Ä–∏–º–µ—Ä 1: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```sql
INSERT INTO users (chat_id, telegram_user_id, username, first_name, last_name, phone, email)
VALUES (987654321, 987654321, 'ivan_petrov', '–ò–≤–∞–Ω', '–ü–µ—Ç—Ä–æ–≤', '+79001234567', 'ivan@example.com');
```

#### –ü—Ä–∏–º–µ—Ä 2: –î–æ–±–∞–≤–∏—Ç—å –ª–∏–¥

```sql
INSERT INTO leads (user_id, name, phone, email, question, status, auto_created, lead_source)
VALUES (1, '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', '+79001234567', 'ivan@example.com', '–ò–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤', 'pending_sync', false, 'telegram');
```

#### –ü—Ä–∏–º–µ—Ä 3: –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É –∫–æ–º–ø–∞–Ω–∏–∏

```sql
INSERT INTO company_services (title, description, category, active)
VALUES ('–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ –≤—ã–±–æ—Ä—É', '–ü–æ–º–æ—â—å –≤ –ø–æ–¥–±–æ—Ä–µ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞', '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏', true);
```

#### –ü—Ä–∏–º–µ—Ä 4: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç

```sql
INSERT INTO prompts (name, content, version, active, role)
VALUES ('greeting', '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –ø–æ–º–æ–≥—É –≤–∞–º –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã.', 1, true, 'system');
```

### 4.3 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º ID

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —É–∑–Ω–∞—Ç—å ID –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏:

```sql
INSERT INTO users (chat_id, username, first_name)
VALUES (111222333, 'test_user', '–¢–µ—Å—Ç')
RETURNING id;
```

### 4.4 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π —Å—Ä–∞–∑—É

```sql
INSERT INTO company_services (title, description, category, active)
VALUES 
    ('–î–æ—Å—Ç–∞–≤–∫–∞', '–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≥–æ—Ä–æ–¥—É', '–õ–æ–≥–∏—Å—Ç–∏–∫–∞', true),
    ('–£—Å—Ç–∞–Ω–æ–≤–∫–∞', '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è', '–°–µ—Ä–≤–∏—Å', true),
    ('–ì–∞—Ä–∞–Ω—Ç–∏—è', '–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞ 3 –≥–æ–¥–∞', '–°–µ—Ä–≤–∏—Å', true);
```

---

## 5. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π (UPDATE)

### 5.1 –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ WHERE! –ò–Ω–∞—á–µ –∏–∑–º–µ–Ω—è—Ç—Å—è –í–°–ï –∑–∞–ø–∏—Å–∏!

**–ë–∞–∑–æ–≤—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:**

```sql
UPDATE table_name
SET column1 = value1, column2 = value2
WHERE condition;
```

### 5.2 –ü—Ä–∏–º–µ—Ä—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è

#### –ü—Ä–∏–º–µ—Ä 1: –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```sql
UPDATE users
SET phone = '+79009998877'
WHERE id = 1;
```

#### –ü—Ä–∏–º–µ—Ä 2: –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ª–∏–¥–∞

```sql
UPDATE leads
SET status = 'synced', sync_attempts = 1
WHERE id = 5;
```

#### –ü—Ä–∏–º–µ—Ä 3: –û–±–Ω–æ–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π

```sql
UPDATE users
SET 
    first_name = '–ò–≤–∞–Ω',
    last_name = '–ò–≤–∞–Ω–æ–≤',
    phone = '+79001112233',
    email = 'newemail@example.com'
WHERE chat_id = 123456789;
```

#### –ü—Ä–∏–º–µ—Ä 4: –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ —É—Å–ª–æ–≤–∏—é

–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —É—Å–ª—É–≥–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

```sql
UPDATE company_services
SET active = true
WHERE category = '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏';
```

#### –ü—Ä–∏–º–µ—Ä 5: –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π –ø—Ä–æ–º–ø—Ç –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π

```sql
-- –°–Ω–∞—á–∞–ª–∞ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å—Ç–∞—Ä—ã–π
UPDATE prompts
SET active = false
WHERE name = 'greeting' AND version = 1;

-- –ó–∞—Ç–µ–º –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω–æ–≤—ã–π
UPDATE prompts
SET active = true
WHERE name = 'greeting' AND version = 2;
```

### 5.3 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```sql
UPDATE users
SET phone = '+79991234567'
WHERE id = 10
RETURNING id, username, phone;
```

### 5.4 –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é!)

–î–æ–±–∞–≤–∏—Ç—å email –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –±–µ–∑ email (–ø—Ä–∏–º–µ—Ä):

```sql
UPDATE users
SET email = username || '@example.com'
WHERE email IS NULL;
```

---

## 6. –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π (DELETE)

### 6.1 –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ WHERE! –ò–Ω–∞—á–µ —É–¥–∞–ª—è—Ç—Å—è –í–°–ï –∑–∞–ø–∏—Å–∏!

**–ë–∞–∑–æ–≤—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:**

```sql
DELETE FROM table_name
WHERE condition;
```

### 6.2 –ü—Ä–∏–º–µ—Ä—ã —É–¥–∞–ª–µ–Ω–∏—è

#### –ü—Ä–∏–º–µ—Ä 1: –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```sql
DELETE FROM users
WHERE id = 999;
```

#### –ü—Ä–∏–º–µ—Ä 2: –£–¥–∞–ª–∏—Ç—å –ª–∏–¥ –ø–æ chat_id

```sql
DELETE FROM leads
WHERE user_id = (SELECT id FROM users WHERE chat_id = 123456789);
```

#### –ü—Ä–∏–º–µ—Ä 3: –£–¥–∞–ª–∏—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —É—Å–ª—É–≥–∏

```sql
DELETE FROM company_services
WHERE active = false;
```

#### –ü—Ä–∏–º–µ—Ä 4: –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏

–£–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π:

```sql
DELETE FROM system_logs
WHERE created_at < NOW() - INTERVAL '30 days';
```

#### –ü—Ä–∏–º–µ—Ä 5: –£–¥–∞–ª–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

```sql
DELETE FROM users
WHERE username LIKE 'test_%';
```

### 6.3 –£–¥–∞–ª–µ–Ω–∏–µ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```sql
DELETE FROM leads
WHERE status = 'failed' AND sync_attempts >= 2
RETURNING id, name, phone, created_at;
```

### 6.4 –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –∏–∑ —Ç–∞–±–ª–∏—Ü—ã

**‚ö†Ô∏è –û–ü–ê–°–ù–û! –£–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ:**

```sql
DELETE FROM table_name;
```

**–ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º:**

```sql
TRUNCATE TABLE table_name;
```

---

## 7. –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

### 7.1 –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º

–†–∞–∑–º–µ—Ä –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã:

```sql
SELECT 
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
```

### 7.2 –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

```sql
SELECT id, chat_id, username, first_name, last_name, created_at
FROM users
ORDER BY created_at DESC
LIMIT 10;
```

### 7.3 –í—Å–µ –ª–∏–¥—ã —Å –æ—à–∏–±–∫–∞–º–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```sql
SELECT 
    l.id,
    l.name,
    l.phone,
    l.email,
    l.status,
    l.sync_attempts,
    l.last_sync_attempt,
    u.username
FROM leads l
LEFT JOIN users u ON l.user_id = u.id
WHERE l.status = 'failed' OR l.sync_attempts > 1
ORDER BY l.last_sync_attempt DESC;
```

### 7.4 –ê–∫—Ç–∏–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ LLM

```sql
SELECT provider, is_active, config
FROM llm_settings
WHERE is_active = true;
```

### 7.5 –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã

```sql
SELECT name, version, role, updated_at
FROM prompts
WHERE active = true
ORDER BY name, version DESC;
```

### 7.6 –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ª–∏–¥–∞–º

```sql
SELECT 
    status,
    COUNT(*) as count,
    COUNT(*) * 100.0 / SUM(COUNT(*)) OVER() as percentage
FROM leads
GROUP BY status
ORDER BY count DESC;
```

### 7.7 –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –¥–∏–∞–ª–æ–≥–∞—Ö

```sql
SELECT 
    m.id,
    c.chat_id,
    m.role,
    LEFT(m.content, 100) as content_preview,
    m.created_at
FROM messages m
JOIN conversations c ON m.conversation_id = c.id
ORDER BY m.created_at DESC
LIMIT 20;
```

### 7.8 –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π –∫–∞—Ç–∞–ª–æ–≥–∞

```sql
SELECT 
    id,
    version_name,
    status,
    total_rows,
    indexed_rows,
    created_at,
    completed_at
FROM catalog_versions
ORDER BY created_at DESC
LIMIT 5;
```

### 7.9 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ AI (—Ç–æ–∫–µ–Ω—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã)

```sql
SELECT 
    provider,
    model,
    year,
    month,
    total_tokens,
    price_per_1k_tokens,
    currency,
    (total_tokens::float / 1000 * price_per_1k_tokens) as total_cost
FROM usage_statistics
ORDER BY year DESC, month DESC;
```

### 7.10 –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ—à–∏–±–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞

```sql
SELECT level, message, created_at
FROM system_logs
WHERE level IN ('ERROR', 'CRITICAL')
  AND created_at > NOW() - INTERVAL '24 hours'
ORDER BY created_at DESC;
```

---

## 8. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –±—ç–∫–∞–ø—ã

### 8.1 –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –ë–î

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (—á–µ—Ä–µ–∑ Docker):**

```bash
docker exec llm-rag-bot-postgres-1 pg_dump -U postgres catalog_db > backup_$(date +%Y%m%d_%H%M%S).sql
```

**–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø–∞–ø–∫—É –±—ç–∫–∞–ø–æ–≤:**

```bash
docker exec llm-rag-bot-postgres-1 pg_dump -U postgres catalog_db > /opt/llm-bot/backups/db_backup_$(date +%Y%m%d_%H%M%S).sql
```

### 8.2 –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏

**‚ö†Ô∏è –û–ü–ê–°–ù–û! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ!**

```bash
# –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ë–î
docker exec llm-rag-bot-postgres-1 psql -U postgres -c "DROP DATABASE catalog_db;"

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é
docker exec llm-rag-bot-postgres-1 psql -U postgres -c "CREATE DATABASE catalog_db;"

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞
cat backup_20250119_120000.sql | docker exec -i llm-rag-bot-postgres-1 psql -U postgres -d catalog_db
```

### 8.3 –≠–∫—Å–ø–æ—Ä—Ç —Ç–∞–±–ª–∏—Ü—ã –≤ CSV

```sql
\copy (SELECT * FROM users) TO '/tmp/users_export.csv' WITH CSV HEADER;
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ Docker:**

```bash
docker exec llm-rag-bot-postgres-1 psql -U postgres -d catalog_db -c "\COPY users TO '/tmp/users.csv' WITH CSV HEADER"
```

### 8.4 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–µ—Ç –ª–∏–¥–æ–≤ –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

```sql
SELECT COUNT(*) 
FROM leads l
LEFT JOIN users u ON l.user_id = u.id
WHERE u.id IS NULL;
```

### 8.5 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ª–∏–¥–æ–≤
SELECT 
    u.id,
    u.username,
    u.first_name,
    COUNT(l.id) as leads_count
FROM users u
LEFT JOIN leads l ON u.id = l.user_id
GROUP BY u.id, u.username, u.first_name
ORDER BY leads_count DESC;
```

---

## 9. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)

### 9.1 –ß—Ç–æ —Ç–∞–∫–æ–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è?

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è - —ç—Ç–æ –≥—Ä—É–ø–ø–∞ –∫–æ–º–∞–Ω–¥, –∫–æ—Ç–æ—Ä—ã–µ –ª–∏–±–æ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤—Å–µ –≤–º–µ—Å—Ç–µ, –ª–∏–±–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–æ–æ–±—â–µ. –≠—Ç–æ –∑–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫.

### 9.2 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

```sql
-- –ù–∞—á–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
BEGIN;

-- –í—ã–ø–æ–ª–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
UPDATE users SET email = 'new@example.com' WHERE id = 1;
UPDATE leads SET phone = '+79001234567' WHERE user_id = 1;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
SELECT * FROM users WHERE id = 1;

-- –ï—Å–ª–∏ –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
COMMIT;

-- –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫ - –æ—Ç–º–µ–Ω–∏—Ç—å
-- ROLLBACK;
```

### 9.3 –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

```sql
BEGIN;

-- –ü–æ–∫–∞–∑–∞—Ç—å —á—Ç–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ
SELECT * FROM leads WHERE status = 'failed' AND sync_attempts > 2;

-- –ï—Å–ª–∏ –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å:
-- DELETE FROM leads WHERE status = 'failed' AND sync_attempts > 2;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
-- SELECT COUNT(*) FROM leads WHERE status = 'failed';

-- –ï—Å–ª–∏ –≤—Å—ë –æ–∫ - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
COMMIT;

-- –ï—Å–ª–∏ –ø–µ—Ä–µ–¥—É–º–∞–ª–∏ - –æ—Ç–º–µ–Ω–∏—Ç—å
-- ROLLBACK;
```

---

## 10. –ë—ã—Å—Ç—Ä–∞—è —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º

### PostgreSQL –∫–æ–Ω—Å–æ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å \)

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `\l` | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö |
| `\dt` | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü |
| `\d table_name` | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã |
| `\du` | –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| `\q` | –í—ã—Ö–æ–¥ –∏–∑ PostgreSQL |
| `\h` | –°–ø—Ä–∞–≤–∫–∞ –ø–æ SQL –∫–æ–º–∞–Ω–¥–∞–º |
| `\?` | –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–Ω—Å–æ–ª—å–Ω—ã–º –∫–æ–º–∞–Ω–¥–∞–º |
| `\timing on` | –í–∫–ª—é—á–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |

### SQL –∫–æ–º–∞–Ω–¥—ã (–∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –Ω–∞ ;)

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `SELECT * FROM table` | –í—ã–±—Ä–∞—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ |
| `INSERT INTO table VALUES (...)` | –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å |
| `UPDATE table SET ... WHERE ...` | –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å |
| `DELETE FROM table WHERE ...` | –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å |
| `COUNT(*)` | –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –∑–∞–ø–∏—Å–∏ |
| `LIMIT N` | –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ |
| `ORDER BY column` | –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ |
| `WHERE condition` | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è |

---

## 11. –¢–∞–±–ª–∏—Ü—ã –ø—Ä–æ–µ–∫—Ç–∞ (—Å–ø—Ä–∞–≤–∫–∞)

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

| –¢–∞–±–ª–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|------------|
| `users` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Telegram –±–æ—Ç–∞ |
| `leads` | –õ–∏–¥—ã (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã) |
| `lead_interactions` | –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ª–∏–¥–∞–º–∏ |
| `conversations` | –î–∏–∞–ª–æ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| `messages` | –°–æ–æ–±—â–µ–Ω–∏—è –≤ –¥–∏–∞–ª–æ–≥–∞—Ö |
| `company_services` | –£—Å–ª—É–≥–∏ –∫–æ–º–ø–∞–Ω–∏–∏ |
| `company_info` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏ |
| `prompts` | –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è LLM |
| `llm_settings` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ |
| `usage_statistics` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AI |
| `catalog_versions` | –í–µ—Ä—Å–∏–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–æ–≤–∞—Ä–æ–≤ |
| `admin_users` | –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —Å–∏—Å—Ç–µ–º—ã |
| `system_logs` | –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ |

### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è

**users:**
- `chat_id` - –æ—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (–ù–ï telegram_user_id!)
- `telegram_user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
- `username`, `first_name`, `last_name` - –¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram
- `phone`, `email` - –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**leads:**
- `user_id` - —Å–≤—è–∑—å —Å —Ç–∞–±–ª–∏—Ü–µ–π users
- `name`, `phone`, `email` - –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `status` - —Å—Ç–∞—Ç—É—Å: pending_sync, synced, failed
- `sync_attempts` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å CRM
- `zoho_lead_id` - ID –ª–∏–¥–∞ –≤ Zoho CRM

**messages:**
- `conversation_id` - —Å–≤—è–∑—å —Å –¥–∏–∞–ª–æ–≥–æ–º
- `role` - —Ä–æ–ª—å: user, assistant, system
- `content` - —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

---

## 12. –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á

### –ó–∞–¥–∞—á–∞ 1: –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –µ–≥–æ –ª–∏–¥—ã

```sql
-- –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ username
SELECT * FROM users WHERE username = 'ivan_petrov';

-- –ù–∞–π—Ç–∏ –µ–≥–æ –ª–∏–¥—ã (–ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å ID –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞)
SELECT * FROM leads WHERE user_id = 123;
```

### –ó–∞–¥–∞—á–∞ 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ª–∏–¥–∞

```sql
-- –ù–∞–π—Ç–∏ –ª–∏–¥
SELECT id, name, status, sync_attempts FROM leads WHERE phone = '+79001234567';

-- –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
UPDATE leads 
SET status = 'pending_sync', sync_attempts = 0
WHERE id = 456;
```

### –ó–∞–¥–∞—á–∞ 3: –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —É—Å–ª—É–≥—É

```sql
INSERT INTO company_services (title, description, category, active)
VALUES ('–ù–æ–≤–∞—è —É—Å–ª—É–≥–∞', '–û–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥–∏', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è', true)
RETURNING id;
```

### –ó–∞–¥–∞—á–∞ 4: –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∏

```sql
SELECT 
    c.id as conversation_id,
    c.chat_id,
    u.username,
    c.started_at,
    COUNT(m.id) as messages_count
FROM conversations c
LEFT JOIN users u ON c.user_id = u.id
LEFT JOIN messages m ON c.id = m.conversation_id
GROUP BY c.id, c.chat_id, u.username, c.started_at
ORDER BY c.started_at DESC
LIMIT 10;
```

### –ó–∞–¥–∞—á–∞ 5: –û—á–∏—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

```sql
BEGIN;

-- –ü–æ–∫–∞–∑–∞—Ç—å —á—Ç–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ
SELECT * FROM users WHERE username LIKE 'test_%';

-- –£–¥–∞–ª–∏—Ç—å (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)
-- DELETE FROM users WHERE username LIKE 'test_%';

COMMIT;
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

1. **–í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø** –ø–µ—Ä–µ–¥ –º–∞—Å—Å–æ–≤—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏!
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** (BEGIN/COMMIT) –¥–ª—è –≤–∞–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
3. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ WHERE** —É—Å–ª–æ–≤–∏—è –ø–µ—Ä–µ–¥ UPDATE –∏ DELETE
4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –º–∞–ª—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –ø–µ—Ä–µ–¥ –º–∞—Å—Å–æ–≤—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
5. **–ù–µ —É–¥–∞–ª—è–π—Ç–µ –¥–∞–Ω–Ω—ã–µ** –±–µ–∑ –∫—Ä–∞–π–Ω–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
6. **–•—Ä–∞–Ω–∏—Ç–µ –±—ç–∫–∞–ø—ã** –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ –≤–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞

---

## üÜò –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

### –ï—Å–ª–∏ —Å–ª—É—á–∞–π–Ω–æ –∏–∑–º–µ–Ω–∏–ª–∏/—É–¥–∞–ª–∏–ª–∏ –¥–∞–Ω–Ω—ã–µ

1. **–ù–ï –ü–ê–ù–ò–ö–£–ô–¢–ï!**
2. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–π–¥–∏—Ç–µ –∏–∑ PostgreSQL (`\q`)
3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±—ç–∫–∞–ø–∞
4. –ï—Å–ª–∏ –±—ç–∫–∞–ø–∞ –Ω–µ—Ç - –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É

### –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ "–∑–∞–≤–∏—Å–ª–∞"

1. –ù–∞–∂–º–∏—Ç–µ `Ctrl + C` –¥–ª—è –æ—Ç–º–µ–Ω—ã
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ–º–∞–Ω–¥—ã
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –∑–∞–ø—Ä–æ—Å

### –ï—Å–ª–∏ –∑–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å –æ—Ç PostgreSQL

–ü–∞—Ä–æ–ª—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ:

```bash
cat /opt/llm-bot/config/.env | grep POSTGRES_PASSWORD
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è PostgreSQL**: https://www.postgresql.org/docs/
- **SQL Tutorial**: https://www.w3schools.com/sql/
- **–û–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –ø—Ä–æ–µ–∫—Ç–∞**: `doc/vision.md` —Ä–∞–∑–¥–µ–ª 5
- **–ú–æ–¥–µ–ª–∏ SQLAlchemy**: `src/infrastructure/database/models.py`

---

**–ê–≤—Ç–æ—Ä**: AI LLM-RAG Bot Team  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 19.01.2025  
**–í–µ—Ä—Å–∏—è**: 1.0

