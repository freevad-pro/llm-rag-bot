---
alwaysApply: true
---
# –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è AI-–∞–≥–µ–Ω—Ç–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤. 

**–û—Å–Ω–æ–≤–∞:** @README.md (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ), @vision.md (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞), @product_idea.md (–¥–µ—Ç–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)

---

## üõ†Ô∏è –£—Ç–∏–ª–∏—Ç—ã –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

- **Python 3.11+** –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
- **aiogram 3.x** –¥–ª—è Telegram (–ø–æ–ª–Ω–æ—Å—Ç—å—é async)
- **FastAPI** –¥–ª—è API + –∞–¥–º–∏–Ω–∫–∏ + WebSocket
- **Chroma** –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ (–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –Ω–∞ –¥–∏—Å–∫–µ)
- **PostgreSQL 15** –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **Docker Compose** –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏

---

## üèóÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### Clean Architecture + –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å
- **–ö–ª–∞—Å—Å—ã**: —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **–§—É–Ω–∫—Ü–∏–∏**: –≤—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
- **DI –≤–µ–∑–¥–µ**: –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
- **Type hints**: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –º–µ—Ç–æ–¥–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–∏–∑ @README.md)
```
src/
‚îú‚îÄ‚îÄ domain/           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ application/      # Telegram + Web handlers  
‚îú‚îÄ‚îÄ infrastructure/   # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, CRM, LLM
‚îî‚îÄ‚îÄ presentation/     # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–∏–∑ @vision.md)
- –ö–∞–∂–¥—ã–π —Å–ª–æ–π –∏–º–µ–µ—Ç —Å–≤–æ–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è: `DomainError`, `InfrastructureError`
- **CRITICAL** ‚Üí Telegram + –ë–î, **ERROR** ‚Üí –ë–î + —Ñ–∞–π–ª
- Retry –ª–æ–≥–∏–∫–∞: –º–∞–∫—Å–∏–º—É–º 2 –ø–æ–ø—ã—Ç–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API

---

## üìù –°—Ç–∏–ª—å –∫–æ–¥–∞

### Naming conventions (–∏–∑ @vision.md)
- **–ö–ª–∞—Å—Å—ã**: `PascalCase` (UserService, LeadRepository)
- **–§—É–Ω–∫—Ü–∏–∏/–º–µ—Ç–æ–¥—ã**: `snake_case` (get_user, create_lead)
- **–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã**: `UPPER_SNAKE_CASE` (MAX_RETRIES)
- **–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ**: `_leading_underscore`

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **–¢–∞–±–ª–∏—Ü—ã**: `snake_case` –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ (users, leads)
- **–ü–æ–ª—è**: `snake_case` (created_at, user_id)
- **–ò–Ω–¥–µ–∫—Å—ã**: `idx_table_fields`

### API endpoints (–∏–∑ @vision.md)
- **REST**: `/api/v1/resource` (plural)
- **Actions**: POST `/api/v1/leads/qualify`

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–°–ª–µ–¥–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏–∑ @README.md –∏ @vision.md:

### Domain —Å–ª–æ–π
- **entities/**: Dataclasses –¥–ª—è —Å—É—â–Ω–æ—Å—Ç–µ–π
- **services/**: –ë–∏–∑–Ω–µ—Å-—Å–µ—Ä–≤–∏—Å—ã (—á–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)
- **interfaces/**: –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –∏ ABC

### Application —Å–ª–æ–π
- **telegram/**: Handlers, states, keyboards
- **web/**: API endpoints, admin routes
- **shared/**: –û–±—â–∏–µ use cases

### Infrastructure —Å–ª–æ–π
- **database/**: PostgreSQL repositories
- **search/**: Chroma + embeddings
- **llm/**: LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (—Ñ–∞–±—Ä–∏–∫–∞)
- **crm/**: Zoho API —Å retry

---

## üì¶ –†–∞–±–æ—Ç–∞ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

### –ò–Ω—ä–µ–∫—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
- –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π
- –§–∞–±—Ä–∏–∫–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

### Pydantic –º–æ–¥–µ–ª–∏ (–∏–∑ @vision.md)
```python
class LeadCreateRequest(BaseModel):
    last_name: str = Field(min_length=1, max_length=200)
    phone: str | None = Field(regex=r'^\+?[1-9]\d{1,14}$')
    email: EmailStr | None
```

---

## ‚ùå –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–∏–∑ @vision.md)
```python
class HybridLogger:
    """
    - DEBUG ‚Üí —Ñ–∞–π–ª—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    - ERROR, WARNING ‚Üí PostgreSQL  
    - CRITICAL ‚Üí PostgreSQL + Telegram –∞–ª–µ—Ä—Ç
    - BUSINESS —Å–æ–±—ã—Ç–∏—è ‚Üí PostgreSQL –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
    """
```

### Retry –ª–æ–≥–∏–∫–∞ (–∏–∑ @README.md)
- **CRM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –º–∞–∫—Å–∏–º—É–º 2 –ø–æ–ø—ã—Ç–∫–∏ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 30 –º–∏–Ω
- **LLM API**: fallback –Ω–∞ –¥—Ä—É–≥–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–∏–∑ @README.md)
```env
DATABASE_URL=postgresql://user:pass@postgres:5432/catalog_db
BOT_TOKEN=xxx
DEFAULT_LLM_PROVIDER=openai
ZOHO_TOKEN_ENDPOINT=xxx
MANAGER_TELEGRAM_CHAT_ID=-100xxx
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É
- –í—ã–±–æ—Ä LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ (–º–µ–Ω–µ–¥–∂–µ—Ä + –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
- –¢–∞–π–º–∞—É—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–ª—è –ª–∏–¥–æ–≤

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏ (–∏–∑ @README.md)
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ < 2 —Å–µ–∫—É–Ω–¥—ã
- –ü–æ–∏—Å–∫ –Ω–∞—Ö–æ–¥–∏—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
- –õ–∏–¥—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ Zoho CRM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –í—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å > 99.5%

### Health checks
- `/health` endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ë–î –∏ Telegram API
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ UptimeRobot –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

---

## üîÑ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞

–ò–∑ @vision.md - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å:

1. **chat_id** - –æ—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ù–ï telegram_user_id)
2. **Retry CRM** - –º–∞–∫—Å–∏–º—É–º 2 –ø–æ–ø—ã—Ç–∫–∏ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 30 –º–∏–Ω—É—Ç  
3. **–ö–æ–Ω—Ç–µ–∫—Å—Ç LLM** - –º–∞–∫—Å–∏–º—É–º 20 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
4. **–Ø–∑—ã–∫ –æ—Ç–≤–µ—Ç–∞** - –í–°–ï–ì–î–ê –Ω–∞ —è–∑—ã–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
5. **–ö–∞—Ç–∞–ª–æ–≥** - —Ç–æ–≤–∞—Ä—ã —Ç–æ–ª—å–∫–æ –≤ Chroma, —É—Å–ª—É–≥–∏ —Ç–æ–ª—å–∫–æ –≤ PostgreSQL
6. **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è** - blue-green deployment –±–µ–∑ –ø—Ä–æ—Å—Ç–æ—è

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–¥–∞–º–∏ (–∏–∑ @product_idea.md)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ > 30 –º–∏–Ω
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ Zoho –ø–æ email/—Ç–µ–ª–µ—Ñ–æ–Ω—É/telegram
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è: –∏–º—è + –æ–¥–∏–Ω –∫–æ–Ω—Ç–∞–∫—Ç
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ª–∏–¥–æ–≤ —á–µ—Ä–µ–∑ Notes API

---

*–ü—Ä–∏–Ω—Ü–∏–ø KISS: –ø—Ä–æ—Å—Ç–æ—Ç–∞, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å*
